/**
 * @license Copyright 2020 The Coding with Chrome Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class PhaserExtras{clear(){var canvasElements=document.getElementsByTagName("canvas");if(canvasElements)for(var canvasElement of canvasElements)canvasElement.style&&"none"==canvasElement.style.touchAction&&"none"==canvasElement.style.userSelect&&canvasElement.remove();document.getElementById("ghostery-tracker-tally")?.remove(),document.getElementById("ghostery-box")?.remove(),document.getElementById("ghostery-pb-background")?.remove()}static addGroupSprite(game,x,y,sprite_name,group,manipulation){game=game.physics.add.sprite(x,y,sprite_name);game.z=100,manipulation&&"function"==typeof manipulation&&manipulation(game),group&&(group.add(game),50<group.getLength())&&group.children.each(sprite=>{(!sprite.active||sprite.y<0||2e3<sprite.y||sprite.x<0||2e3<sprite.x)&&group.remove(sprite,!0,!0)})}static VerticalObstacleGenerator(game,x,y,num_blocks,space,sprite,opt_sprite_top,opt_sprite_bottom,group,manipulation){var spriteSize=PhaserExtras.getSpriteSize(game,sprite,manipulation),spriteSpace=Phaser.Math.RND.integerInRange(0,num_blocks-space-1);for(let i=0;i<num_blocks;i++)if(i<spriteSpace||i>=spriteSpace+space){let groupSprite=sprite;i==spriteSpace+space&&opt_sprite_bottom?groupSprite=opt_sprite_bottom:i==spriteSpace-1&&opt_sprite_top&&(groupSprite=opt_sprite_top),PhaserExtras.addGroupSprite(game,x+spriteSize.width,y+i*spriteSize.height,groupSprite,group,manipulation)}}static RandomVerticalObstacleGenerator(game,x,y,num_blocks,sprite,opt_sprite,group,direction,manipulation){var spriteSize=PhaserExtras.getSpriteSize(game,sprite,manipulation),numBlocks=Phaser.Math.RND.integerInRange(0,num_blocks);"top"===direction&&(y-=spriteSize.height);for(let i=1;i<=numBlocks;i++)"top"===direction?PhaserExtras.addGroupSprite(game,x,y+i*spriteSize.height,opt_sprite&&i===numBlocks?opt_sprite:sprite,group,manipulation):PhaserExtras.addGroupSprite(game,x,y-i*spriteSize.height,opt_sprite&&i===numBlocks?opt_sprite:sprite,group,manipulation)}static MatrixBlockGenerator(game,sprite,data,x=0,y=0,padding=10,group,manipulation){let index=0;var blockX,blockY,spriteSize=PhaserExtras.getSpriteSize(game,sprite,manipulation),spriteWidthFactor=spriteSize.width+padding,spriteHeightFactor=spriteSize.height+padding;for(let row=0;row<=7;row++)for(let column=0;column<=7;column++)data[index++]&&(blockX=column*spriteWidthFactor+x,blockY=row*spriteHeightFactor+y,PhaserExtras.addGroupSprite(game,blockX,blockY,sprite,group,manipulation))}static getSpriteSize(game,sprite,manipulation){var texture=game.textures.get(sprite);let width=texture?.source?.[0]?.width,height=texture?.source?.[0]?.height;return width&&height&&!manipulation||((texture=game.physics.add.sprite(0,0,sprite)).visible=!1,manipulation&&"function"==typeof manipulation&&manipulation(texture),width=texture.width,height=texture.height,texture.destroy()),{width:width,height:height}}static takeScreenshot(game){if(game&&game.canvas){let width=game.canvas.width,height=game.canvas.height;width/height>270/152?(width=270,height=width/game.canvas.width*game.canvas.height):(height=152,width=height/game.canvas.height*game.canvas.width);var preview=document.createElement("canvas"),ctx=(preview.width=270,preview.height=152,preview.getContext("2d"));return ctx.fillStyle="rgba(0, 0, 0, 0)",ctx.fillRect(0,0,preview.width,preview.height),ctx.drawImage(game.canvas,0,0,game.canvas.width,game.canvas.height,(270-width)/2,(152-height)/2,width,height),preview.toDataURL()}console.warn("Unable to take screenshot for ",game,"!")}static showScreenshot(game){var image=new Image;image.src=PhaserExtras.takeScreenshot(game),window.open("").document.write(image.outerHTML)}static sendScreenshot(game){game=PhaserExtras.takeScreenshot(game);game&&window.parent&&window.parent.postMessage({type:"screenshot",value:game},""+window.location.origin)}static sendError(error){error&&window.parent&&window.parent.postMessage({type:"error",value:error},""+window.location.origin)}static sendRuntimeError(error){error&&window.parent&&window.parent.postMessage({type:"runtime_error",value:error},""+window.location.origin)}}document.addEventListener("DOMContentLoaded",function(){(new PhaserExtras).clear()}),window.error=function(message,source,lineno,colno,error){PhaserExtras.sendRuntimeError(error)},document.addEventListener("error",function(event){PhaserExtras.sendError(event)}),window.location.pathname.endsWith("/screenshot")&&window.addEventListener("load",function(){window.setTimeout(()=>{PhaserExtras.sendScreenshot(window.game)},750)});